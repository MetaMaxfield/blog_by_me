<div class="pagination">

    <ul>

        {% if page.has_previous %}

            {% if page.number|add:'-3' > 1 %}

                <li>
                    <a href="?q={{ q }}&page=1">1</a>
                </li>

            {% endif %}

            {% if page.number|add:'-3' >= 3 %}
                <li>
                    <a href="?q={{ q }}&page={{ page.previous_page_number|add:'-3' }}">
                    <span>...</span>
                    </a>
                </li>
            {% endif %}

        {% endif %}

        {% if paginator.page_range|length > 1 %}

            {% for i in paginator.page_range %}

                {% if page.number == i %}
                    <li>
                        <a href="#"><font color="grey">{{ i }}</font></a>
                    </li>
                {% elif i > page.number|add:'-4' and i < page.number|add:'4' %}
                    <li>
                        <a href="?q={{ q }}&page={{ i }}">{{ i }}</a>
                    </li>
                {% endif %}

            {% endfor %}

        {% endif %}

        {% if page.has_next %}

            {% if page.number|add:'4' < page.paginator.num_pages %}
                <li>
                    <a href="?q={{ q }}&page={{ page.next_page_number|add:'3' }}">
                        <span>...</span>
                    </a>
                </li>
            {% endif %}

            {% if page.number|add:'3' < page.paginator.num_pages %}
                <li>
                    <a href="?q={{ q }}&page={{ page.paginator.num_pages }}">
                        {{ page.paginator.num_pages }}
                    </a>
                </li>
            {% endif %}

        {% endif %}

    </ul>

</div>